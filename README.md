# –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ RAG-–±–æ—Ç–∞ –¥–ª—è Telegram

**Retrieval-Augmented Generation + Telegram Bot = –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–∞—è —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.**

## üìå –ö—Ä–∞—Ç–∫–æ

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω—É—é RAG-—Å–∏—Å—Ç–µ–º—É (Retrieval-Augmented Generation), –∫–æ—Ç–æ—Ä–∞—è:

- –ò—â–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –≤ –≤–∞—à–µ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π (BM25 + –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫).
- –§–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∏ –ø–∞—Ä—ã –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–∏–∞–ª–æ–≥–∞.
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ GPT-4o-mini, —Å—Ç—Ä–æ–≥–æ –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram-—á–∞—Ç–µ.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞



- **BM25** ‚Äî –±—ã—Å—Ç—Ä–æ –æ—Ç–±–∏—Ä–∞–µ—Ç ¬´–≥—Ä—É–±—ã–µ¬ª —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–æ —Ç–µ—Ä–º–∏–Ω–∞–º.
- **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫** ‚Äî —É—Ç–æ—á–Ω—è–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –±–ª–∏–∑–∫–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.
- **LLM-—Ä–µ—Ä–∞–Ω–∫–µ—Ä** ‚Äî –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ—Ç —Ç–æ–ø-K –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–π –±–ª–∏–∑–æ—Å—Ç–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

| –§–∞–π–ª            | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                 |
|-----------------|----------------------------------------------------------------------------|
| test_bot.py     | Telegram-–æ–±—ë—Ä—Ç–∫–∞: –∫–æ–º–∞–Ω–¥—ã, throttling, –≤—ã–∑–æ–≤ ChatManager                   |
| chat_manager.py | –õ–æ–≥–∏–∫–∞ –¥–∏–∞–ª–æ–≥–∞: —É—Ç–æ—á–Ω–µ–Ω–∏—è, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞, –≤—ã–∑–æ–≤ LLM                 |
| hybrid_search.py| –ö–æ–º–±–∏–Ω–∞—Ü–∏—è BM25 + –≤–µ–∫—Ç–æ—Ä—ã + LLM-—Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥                                  |
| db.py           | –ó–∞–≥—Ä—É–∑–∫–∞ DOC/DOCX/TXT, –Ω–∞—Ä–µ–∑–∫–∞ –Ω–∞ —á–∞–Ω–∫–∏, ChromaDB                          |
| history.py      | –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ chat_histories.json                                    |
| ai_settings.py  | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏, —Å–∏—Å—Ç–µ–º–Ω—ã–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç                      |
| app.py          | –ú–∏–Ω–∏-—É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ LLM (debug)                          |

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ò–º—è                   | –û–ø–∏—Å–∞–Ω–∏–µ                               |
|-----------------------|----------------------------------------|
| OPENAI_API_KEY        | –ö–ª—é—á OpenAI –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ —á–∞—Ç–∞     |
| TELEGRAM_TEST_BOT_API | –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞                    |

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ¬´—Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏¬ª –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `hybrid_search.py`:

| –ü–∞—Ä–∞–º–µ—Ç—Ä   | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                  |
|------------|-------------------------------------------------------------|
| alpha      | –ë–∞–ª–∞–Ω—Å BM25 ‚Üî –≤–µ–∫—Ç–æ—Ä–∞ (0 ‚Ä¶ 1)                               |
| min_score  | –ü–æ—Ä–æ–≥ –æ—Ç—Å–µ—á–µ–Ω–∏—è –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤                    |
| top_k      | –°–∫–æ–ª—å–∫–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç                      |
| llm_weight | –ù–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è LLM-—Ä–µ—Ä–∞–Ω–∫–µ—Ä                   |

## üß© –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø–æ—à–∞–≥–æ–≤–æ

1. **–ó–∞–ø—É—Å–∫** ‚Äî –±–æ—Ç —Å–æ–∑–¥–∞—ë—Ç/–ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –∏–Ω–¥–µ–∫—Å ChromaDB –∏ BM25-–∫–æ—Ä–ø—É—Å.
2. **–°–æ–æ–±—â–µ–Ω–∏–µ** `/start` –∏–ª–∏ —Ç–µ–∫—Å—Ç ‚Äî –ø–æ–ø–∞–¥–∞–µ—Ç –≤ ChatManager.
3. **–ü–æ–∏—Å–∫** ‚Äî HybridSearch –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ø-k —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.
4. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞** ‚Äî –±–æ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–æ–æ–±—â–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ + –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.
5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è** ‚Äî GPT-4o-mini –≤—ã–¥–∞—ë—Ç –æ—Ç–≤–µ—Ç, —Å—Ç—Ä–æ–≥–æ –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç.
6. **–û—Ç–ø—Ä–∞–≤–∫–∞** ‚Äî –±–æ—Ç —à–ª—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–≤–µ—Ç + –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–æ—Å–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω/—É—Ç–æ—á–Ω–µ–Ω–∏—è.
7. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏** ‚Äî –¥–∏–∞–ª–æ–≥ –ø–∏—à–µ—Ç—Å—è –≤ `chat_histories.json` (–ª–∏–º–∏—Ç ‚Äî MAX_HISTORY).

## –ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ–ø–∏—Å–∫–∏

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤ —Å –±–æ—Ç–æ–º:

[![–ü—Ä–∏–º–µ—Ä 1](https://i.ibb.co/b5CFxtn7/image.png)](https://i.ibb.co/b5CFxtn7/image.png)  
[![–ü—Ä–∏–º–µ—Ä 2](https://i.ibb.co/S71NncHF/image.png)](https://i.ibb.co/S71NncHF/image.png)  
[![–ü—Ä–∏–º–µ—Ä 3](https://i.ibb.co/bj5MzhrQ/image.png)](https://i.ibb.co/bj5MzhrQ/image.png)  
[![–ü—Ä–∏–º–µ—Ä 4](https://i.ibb.co/XxtjPqR0/image.png)](https://i.ibb.co/XxtjPqR0/image.png)  
[![–ü—Ä–∏–º–µ—Ä 5](https://i.ibb.co/CFDfQtW/image.png)](https://i.ibb.co/CFDfQtW/image.png)  
[![–ü—Ä–∏–º–µ—Ä 6](https://i.ibb.co/ynntw3hS/image.png)](https://i.ibb.co/ynntw3hS/image.png)  

**–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞:**

[![–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ 1](https://i.ibb.co/ZRBdCdSV/image.png)](https://i.ibb.co/ZRBdCdSV/image.png)  
[![–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ 2](https://i.ibb.co/xKLsYNxm/image.png)](https://i.ibb.co/xKLsYNxm/image.png)  